# Ruleset source
# https://github.com/aquasecurity/trivy-checks/tree/main/checks/docker

name: Trivy test
rules:
  - scope: output
    category: Negative
    instruction: |
      assert(command_util.command_always_has_param("apt-get install","--no-install-recommends"))
    description: Ensure that apt always skips recommends
    id: apt_get_skip_recommends
    target: command
    long_description: |
      Don't install unwanted recommended packages

  - scope: output
    category: Negative
    instruction: |
      assert(command_util.command_always_has_param("apt install","--no-install-recommends"))
    description: Ensure that apt always skips recommends
    id: apt_skip_recommends
    target: command
    long_description: |
      Don't install unwanted recommended packages

  - scope: output
    category: Negative
    instruction: |
      assert(len(command_util.get_every_node_of_instruction("HEALTHCHECK")) > 1)
    id: healthcheck defined
    target: command

  - scope: output
    category: Negative
    instruction: |
      assert(len(command_util.get_every_node_of_instruction("HEALTHCHECK")) < 2)
    id: No multiple healthchecks
    target: command
